{"version":3,"file":"create-vue-store.js","sourceRoot":"","sources":["create-vue-store.ts"],"names":[],"mappings":"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","sourcesContent":["import { getOidcCallbackPath, createUserManager, addUserManagerEventListener, tokenIsExpired, tokenExp, createOidClient, removeUserManagerEventListener } from '../services/oidc-helpers'\r\nimport { dispatchCustomBrowserEvent } from '../services/browser-event'\r\nimport type { StoreOidcListeners, OidcStoreSettings, StoreOidcClientSettings, OidcStoreGetters, OidcStoreState, PayloadType } from '../types/vue-store'\r\nimport type { RouteLocationNormalized } from 'vue-router'\r\n\r\nexport default (oidcClientSettings: StoreOidcClientSettings, storeSettings: OidcStoreSettings = {}, oidcEventListeners: StoreOidcListeners = {}) => {\r\n  const oidcUserManager = createUserManager(oidcClientSettings)\r\n  const oidcClient = createOidClient(oidcClientSettings)\r\n  // default authentication is set to id_token\r\n  if (!storeSettings.isAuthenticatedBy) storeSettings.isAuthenticatedBy = 'id_token'\r\n\r\n  const oidcCallbackPath = getOidcCallbackPath(oidcClientSettings.redirect_uri, storeSettings.routeBase || '/')\r\n  const oidcPopupCallbackPath = getOidcCallbackPath(oidcClientSettings.popupRedirectUri || '', storeSettings.routeBase || '/')\r\n  const oidcSilentCallbackPath = getOidcCallbackPath(oidcClientSettings.silentRedirectUri || '', storeSettings.routeBase || '/')\r\n\r\n  // Add event listeners passed into factory function\r\n  Object.keys(oidcEventListeners).forEach(eventName => {\r\n    addUserManagerEventListener(oidcUserManager, eventName, oidcEventListeners[eventName])\r\n  })\r\n  let userManagerEvents\r\n  if (storeSettings.dispatchEventsOnWindow) {\r\n    // Dispatch oidc-client events on window (if in browser)\r\n    userManagerEvents = [\r\n      'userLoaded',\r\n      'userUnloaded',\r\n      'accessTokenExpiring',\r\n      'accessTokenExpired',\r\n      'silentRenewError',\r\n      'userSignedOut'\r\n    ]\r\n    userManagerEvents.forEach(eventName => {\r\n      addUserManagerEventListener(oidcUserManager, eventName, (detail: StoreOidcListeners) => {\r\n        dispatchCustomBrowserEvent(eventName, detail || {})\r\n      })\r\n    })\r\n  }\r\n  const addOidcEventListener = (payload: PayloadType) =>{\r\n    addUserManagerEventListener(oidcUserManager, getPayloadItem(payload, 'eventName'), getPayloadItem(payload, 'eventListener'))\r\n  }\r\n  const removeOidcEventListener = (payload: PayloadType) => {\r\n    removeUserManagerEventListener(oidcUserManager, getPayloadItem(payload, 'eventName'), getPayloadItem(payload, 'eventListener'))\r\n  }\r\n\r\n  const routeIsPublic = (route: RouteLocationNormalized) => {\r\n    if (route.meta && route.meta.isPublic) {\r\n      return true\r\n    }\r\n    if (route.meta && Array.isArray(route.meta) && route.meta.reduce((isPublic, meta) => meta.isPublic || isPublic, false)) {\r\n      return true\r\n    }\r\n    if (storeSettings.publicRoutePaths && storeSettings.publicRoutePaths.map(path => path.replace(/\\/$/, '')).indexOf(route.path.replace(/\\/$/, '')) > -1) {\r\n      return true\r\n    }\r\n    if (storeSettings.isPublicRoute && typeof storeSettings.isPublicRoute === 'function') {\r\n      return storeSettings.isPublicRoute(route)\r\n    }\r\n    return false\r\n  }\r\n\r\n  const routeIsOidcCallback = (route: RouteLocationNormalized) => {\r\n    if (route.meta && route.meta.isOidcCallback) {\r\n      return true\r\n    }\r\n    if (route.meta && Array.isArray(route.meta) && route.meta.reduce((isOidcCallback, meta) => meta.isOidcCallback || isOidcCallback, false)) {\r\n      return true\r\n    }\r\n    if (route.path && route.path.replace(/\\/$/, '') === oidcCallbackPath) {\r\n      return true\r\n    }\r\n    if (route.path && route.path.replace(/\\/$/, '') === oidcPopupCallbackPath) {\r\n      return true\r\n    }\r\n    if (route.path && route.path.replace(/\\/$/, '') === oidcSilentCallbackPath) {\r\n      return true\r\n    }\r\n    return false\r\n  }\r\n\r\n\r\n  const getPayloadItem = (payload: any, option: string): any => {\r\n    if (payload) {\r\n      if (typeof payload === 'string') {\r\n        return payload\r\n      }\r\n      else {\r\n        if (option in payload) {\r\n          if (payload.option) return option\r\n        }\r\n      }\r\n    }\r\n    return null\r\n  }\r\n  const errorPayload = (context: string, error: any): PayloadType => {\r\n    return {\r\n      context,\r\n      error: error && error.message ? error.message : error\r\n    }\r\n  }\r\n\r\n  const dispatchCustomErrorEvent = (eventName: string, payload: {} | undefined) => {\r\n    // oidcError and automaticSilentRenewError are not UserManagement events, they are events implemeted in vuex-oidc,\r\n    if (typeof oidcEventListeners[eventName] === 'function') {\r\n      oidcEventListeners[eventName](payload)\r\n    }\r\n    if (storeSettings.dispatchEventsOnWindow) {\r\n      dispatchCustomBrowserEvent(eventName, payload)\r\n    }\r\n  }\r\n\r\n  const OidcStoreGetters: OidcStoreGetters = {\r\n    oidcIsAuthenticated: (state: OidcStoreState) => {\r\n      if (storeSettings.isAuthenticatedBy) {\r\n        if (state[storeSettings.isAuthenticatedBy]) {\r\n          return true\r\n        }\r\n      }\r\n      return false\r\n    },\r\n    oidcUser: (state: OidcStoreState) => {\r\n      return state.user\r\n    },\r\n    oidcAccessToken: (state: OidcStoreState) => {\r\n      return tokenIsExpired(state.access_token) ? null : state.access_token\r\n    },\r\n    oidcAccessTokenExp: (state: OidcStoreState) => {\r\n      return tokenExp(state.access_token)\r\n    },\r\n    oidcScopes: (state: OidcStoreState) => {\r\n      return state.scopes\r\n    },\r\n    oidcIdToken: (state: OidcStoreState) => {\r\n      return tokenIsExpired(state.id_token) ? null : state.id_token\r\n    },\r\n    oidcIdTokenExp: (state: OidcStoreState) => {\r\n      return tokenExp(state.id_token)\r\n    },\r\n    oidcRefreshToken: (state: OidcStoreState) => {\r\n      return tokenIsExpired(state.refresh_token) ? null : state.refresh_token\r\n    },\r\n    oidcRefreshTokenExp: (state: OidcStoreState) => {\r\n      return tokenExp(state.refresh_token)\r\n    },\r\n    oidcAuthenticationIsChecked: (state: OidcStoreState) => {\r\n      return state.is_checked\r\n    },\r\n    oidcError: (state: OidcStoreState) => {\r\n      return state.error\r\n    },\r\n    oidcIsRoutePublic: (state: OidcStoreState) => {\r\n      return (route: RouteLocationNormalized) => {\r\n        return routeIsPublic(route)\r\n      }\r\n    }\r\n  }\r\n\r\n  // actions\r\n  const authenticateOidc = (payload: PayloadType | undefined) => {\r\n    const redirectPath = getPayloadItem(payload, 'redirectPath')\r\n    if (redirectPath) {\r\n      sessionStorage.setItem('vue_oidc_active_route', redirectPath)\r\n    } else {\r\n      sessionStorage.removeItem('vue_oidc_active_route')\r\n    }\r\n\r\n    // Take options for signinRedirect from 1) payload or 2) storeSettings if defined there\r\n    const options = getPayloadItem(payload, 'options') || storeSettings.defaultSigninRedirectOptions || {}\r\n    return oidcUserManager.signinRedirect(options)\r\n  }\r\n  \r\n  return {  oidcUserManager, oidcClient, OidcStoreGetters,\r\n          routeIsPublic, routeIsOidcCallback, getPayloadItem, errorPayload, \r\n          dispatchCustomErrorEvent, addOidcEventListener, removeOidcEventListener,\r\n          authenticateOidc,\r\n  }\r\n}\r\n"]}